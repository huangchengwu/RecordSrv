<!DOCTYPE html>
<html lang="zh">
<head>
 <meta charset="UTF-8" />
 <title>ä¸­æ–‡è¯­éŸ³è¯†åˆ«ï¼ˆä¸Šä¼ éŸ³é¢‘ï¼‰</title>
</head>
<body>
 <h2>ğŸ“‚ ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶è¿›è¡Œä¸­æ–‡è¯­éŸ³è¯†åˆ«</h2>
 <input type="file" id="audio-file" accept="audio/*" />
 <pre id="output">è¯†åˆ«ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</pre>

 <!-- å¼•å…¥ vosk-browser -->
 <script src="https://cdn.jsdelivr.net/npm/vosk-browser@0.0.3/dist/vosk.js"></script>
 <script>
 let model;
 let recognizer;

 async function initModel() {
 if (!model) {
 // åŠ è½½ä¸­æ–‡æ¨¡å‹ï¼ˆä½ éœ€è¦å°†è¯¥ zip æ¨¡å‹éƒ¨ç½²åœ¨ä½ çš„ç½‘ç«™è·¯å¾„ä¸Šï¼‰
 model = await Vosk.createModel('vosk-model-small-cn-0.22.zip');
 recognizer = new model.KaldiRecognizer(16000); // ä½¿ç”¨ 16kHz é‡‡æ ·ç‡
 
 // ç›‘å¬è¯†åˆ«ç»“æœäº‹ä»¶
 recognizer.on('result', (msg) => {
 document.getElementById('output').textContent +=
 '\n[æœ€ç»ˆç»“æœ] ' + msg.result.text;
 });
 recognizer.on('partialresult', (msg) => {
 document.getElementById('output').textContent =
 '[è¯†åˆ«ä¸­] ' + msg.result.partial;
 });
 }
 }

 async function recognizeAudio(file) {
 const audioContext = new AudioContext({ sampleRate: 16000 });
 const arrayBuffer = await file.arrayBuffer();
 const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

 // å°†æ•´ä¸ª AudioBuffer å¯¹è±¡ä¼ å…¥
 recognizer.acceptWaveform(audioBuffer);
 }

 document.getElementById('audio-file').addEventListener('change', async (event) => {
 const file = event.target.files[0];
 if (!file) return;

 document.getElementById('output').textContent = 'â³ æ­£åœ¨åŠ è½½æ¨¡å‹å¹¶å¤„ç†éŸ³é¢‘...';

 await initModel();
 await recognizeAudio(file);
 });
 </script>
</body>
</html>

